@page "/"
@page "/catalogue"
@using Ecommerce.DTO
@using Ecommerce.Frontend.Services.Contrat
@using Ecommerce.Frontend.Shared

@inject IProductoService productoServicio;
@inject ICategoriaService categoriaServicio;
@inject NavigationManager navManager

<BreadCrumb BreadcrumbItems="@breadcrumbItems" />

<div class="shop_section shop_reverse">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-12">
                <!--sidebar widget start-->
                <aside class="sidebar_widget">
                    <div class="widget_inner">
                        <div class="widget_list widget_categories">
                            <h2>Categories</h2>
                            <ul>
                                <li class="widget_sub_categories">
                                    <a href="javascript:void(0)" data-toggle="collapse" data-target="#men">Men</a>
                                    <ul class="widget_dropdown_categories collapse show" id="men">
                                        <li><a href="#"> New products <span>104</span></a></li>
                                        <li><a href="#">Gymwear <span>68</span></a></li>
                                        <li><a href="#">Jakets <span>75</span></a></li>
                                        <li><a href="#">Jeans <span>30</span></a></li>
                                        <li><a href="#">Shirts <span>150</span></a></li>
                                        <li><a href="#">T-Shirts <span>113</span></a></li>
                                        <li><a href="#">Accessories <span>95</span></a></li>
                                    </ul>
                                </li>
                                <li class="widget_sub_categories">
                                    <a href="javascript:void(0)" data-toggle="collapse" data-target="#women">women</a>
                                    <ul class="widget_dropdown_categories collapse" id="women">
                                        <li><a href="#"> New products <span>104</span></a></li>
                                        <li><a href="#">Gymwear <span>68</span></a></li>
                                        <li><a href="#">Jakets <span>75</span></a></li>
                                        <li><a href="#">Jeans <span>30</span></a></li>
                                        <li><a href="#">Shirts <span>150</span></a></li>
                                        <li><a href="#">T-Shirts <span>113</span></a></li>
                                        <li><a href="#">Accessories <span>95</span></a></li>
                                    </ul>
                                </li>
                                <li class="widget_sub_categories">
                                    <a href="javascript:void(0)" data-toggle="collapse" data-target="#footwear">footwear</a>
                                    <ul class="widget_dropdown_categories collapse" id="footwear">
                                        <li><a href="#"> New products <span>104</span></a></li>
                                        <li><a href="#">Gymwear <span>68</span></a></li>
                                        <li><a href="#">Jakets <span>75</span></a></li>
                                        <li><a href="#">Jeans <span>30</span></a></li>
                                        <li><a href="#">Shirts <span>150</span></a></li>
                                        <li><a href="#">T-Shirts <span>113</span></a></li>
                                        <li><a href="#">Accessories <span>95</span></a></li>
                                    </ul>
                                </li>
                                <li class="widget_sub_categories">
                                    <a href="javascript:void(0)" data-toggle="collapse" data-target="#accessories">accessories</a>
                                    <ul class="widget_dropdown_categories collapse" id="accessories">
                                        <li><a href="#"> New products <span>104</span></a></li>
                                        <li><a href="#">Gymwear <span>68</span></a></li>
                                        <li><a href="#">Jakets <span>75</span></a></li>
                                        <li><a href="#">Jeans <span>30</span></a></li>
                                        <li><a href="#">Shirts <span>150</span></a></li>
                                        <li><a href="#">T-Shirts <span>113</span></a></li>
                                        <li><a href="#">Accessories <span>95</span></a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div class="widget_list widget_filter">
                            <h2>Filter By</h2>
                            <div class="filter__list slider_range">
                                <h3>price</h3>
                                <form action="#">
                                    <div id="slider-range" class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all"><div class="ui-slider-range ui-widget-header ui-corner-all" style="left: 3.2%; width: 76.8%;"></div><span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0" style="left: 3.2%;"></span><span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0" style="left: 80%;"></span></div>
                                    <span>Range:</span>
                                    <input type="text" name="text" id="amount">

                                </form>
                            </div>

                            <div class="filter__list widget_size">
                                <h3> size</h3>
                                <ul>
                                    <li>
                                        <a href="javascript:void(0)">S </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)"> M</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)">L</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)"> XL</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)">XLL</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="filter__list widget_color">
                                <h3>color</h3>
                                <ul>
                                    <li>
                                        <input type="checkbox">
                                        <span class="checkmark color1"></span>
                                    </li>
                                    <li>
                                        <input type="checkbox">
                                        <span class="checkmark color2"></span>
                                    </li>
                                    <li>
                                        <input type="checkbox">
                                        <span class="checkmark color3"></span>
                                    </li>
                                    <li>
                                        <input type="checkbox">
                                        <span class="checkmark color4"></span>
                                    </li>
                                    <li>
                                        <input type="checkbox">
                                        <span class="checkmark color5"></span>
                                    </li>
                                    <li>
                                        <input type="checkbox">
                                        <span class="checkmark color6"></span>
                                    </li>
                                    <li>
                                        <input type="checkbox">
                                        <span class="checkmark color7"></span>
                                    </li>
                                    <li>
                                        <input type="checkbox">
                                        <span class="checkmark color8"></span>
                                    </li>
                                </ul>
                            </div>
                            <div class="filter__list widget_brands">
                                <h3 data-toggle="collapse" data-target="#brands">brands</h3>
                                <ul class="widget_dropdown_categories collapse show" id="brands">
                                    <li><a href="#"> The North Face <span>104</span></a></li>
                                    <li><a href="#">Zara Basic <span>68</span></a></li>
                                    <li><a href="#">Moschino <span>75</span></a></li>
                                    <li><a href="#">Supreme <span>30</span></a></li>
                                    <li><a href="#">Ecko Unltd <span>150</span></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="widget_list">
                            <h2>Recent Product</h2>
                            <div class="recent_product">
                                <div class="recent_product_list d-flex mb-25">
                                    <div class="recent_thumb">
                                        <a href="product-details.html"><img src="assets/img/product/product4.jpg" alt=""></a>
                                    </div>
                                    <div class="recent_content">
                                        <h4><a href="product-details.html">Barbour T-shirt <br> International</a></h4>
                                        <span>$32.00</span>
                                    </div>
                                </div>
                                <div class="recent_product_list d-flex">
                                    <div class="recent_thumb">
                                        <a href="product-details.html"><img src="assets/img/product/product6.jpg" alt=""></a>
                                    </div>
                                    <div class="recent_content">
                                        <h4><a href="product-details.html">Barbour T-shirt <br> International</a></h4>
                                        <span>$32.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
                <!--sidebar widget end-->
            </div>
            <div class="col-lg-9 col-md-12">
                <!--shop wrapper start-->

                <div class="shop_banner d-flex align-items-center" data-bgimg="assets/img/bg/shop_bg.jpg" style="background-image: url(&quot;assets/img/bg/shop_bg.jpg&quot;);">
                    <div class="shop_banner_text">
                        <h2>essential <br> wears</h2>
                        <p>The collections basic items <br> essential for all girls</p>
                    </div>
                </div>
                <!--shop toolbar start-->
                <div class="shop_toolbar_wrapper d-flex justify-content-between align-items-center">
                    <div class="page_amount">
                        <p><span>1.260</span> Products Found</p>
                    </div>
                    <div class=" sorting_by d-flex align-items-center">
                        <span>SORT BY :</span>
                        <form class="select_option" action="#" style="display: none;">
                            <select name="orderby" id="short" style="display: none;">

                                <option selected="" value="1">NAME       3</option>
                                <option value="2">NAME  4</option>
                                <option value="3">NAME  5</option>
                                <option value="4">NAME  6</option>
                                <option value="5">NAME  7</option>
                                <option value="6">NAME  8</option>
                            </select><div class="nice-select" tabindex="0"><span class="current">NAME       3</span><ul class="list"><li data-value="1" class="option selected">NAME       3</li><li data-value="2" class="option">NAME  4</li><li data-value="3" class="option">NAME  5</li><li data-value="4" class="option">NAME  6</li><li data-value="5" class="option">NAME  7</li><li data-value="6" class="option">NAME  8</li></ul></div>
                        </form><div class="nice-select select_option" tabindex="0"><span class="current">NAME       3</span><ul class="list"><li data-value="1" class="option selected">NAME       3</li><li data-value="2" class="option">NAME  4</li><li data-value="3" class="option">NAME  5</li><li data-value="4" class="option">NAME  6</li><li data-value="5" class="option">NAME  7</li><li data-value="6" class="option">NAME  8</li></ul></div>
                    </div>
                    <div class="toolbar_btn_wrapper d-flex align-items-center">
                        <div class="view_btn">
                            <a class="view" href="#">VIEW</a>
                        </div>
                        <div class="shop_toolbar_btn">
                            <ul class="d-flex align-items-center">
                                <li><a href="#" class="active btn-grid-3" data-role="grid_3" data-tippy="3" data-tippy-inertia="true" data-tippy-delay="50" data-tippy-arrow="true" data-tippy-placement="top"><i class="ion-grid"></i></a></li>

                                <li><a href="#" class="btn-list" data-role="grid_list" data-tippy="List" data-tippy-inertia="true" data-tippy-delay="50" data-tippy-arrow="true" data-tippy-placement="top"><i class="ion-navicon"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!--shop toolbar end-->
                <div class="row shop_wrapper">
                    <div class="col-lg-4 col-md-4 col-sm-6 col-6 ">
                        <div class="single_product">
                            <div class="product_thumb">
                                <a href="product-details.html">
                                    <img class="primary_img" src="assets/img/product/product1.jpg" alt="consectetur">
                                </a>
                                <div class="product_action">
                                    <ul>
                                        <li class="wishlist"><a href="#" data-tippy="Wishlist" data-tippy-inertia="true" data-tippy-delay="50" data-tippy-arrow="true" data-tippy-placement="left"><i class="icon-heart icons"></i></a></li>

                                        <li class="quick_view"><a data-toggle="modal" data-target="#modal_box" data-tippy="Quick View" href="#" data-tippy-inertia="true" data-tippy-delay="50" data-tippy-arrow="true" data-tippy-placement="left"><i class="icon-size-fullscreen icons"></i></a></li>
                                        <li class="compare"><a data-tippy="Compare" href="#" data-tippy-inertia="true" data-tippy-delay="50" data-tippy-arrow="true" data-tippy-placement="left"><i class="icon-refresh icons"></i></a></li>
                                    </ul>
                                </div>
                                <div class="product_label">
                                    <span>-18%</span>
                                </div>
                            </div>
                            <div class="product_content grid_content text-center">
                                <div class="product_ratting">
                                    <ul class="d-flex justify-content-center">
                                        <li><a href="#"><i class="ion-android-star"></i></a></li>
                                        <li><a href="#"><i class="ion-android-star"></i></a></li>
                                        <li><a href="#"><i class="ion-android-star"></i></a></li>
                                        <li><a href="#"><i class="ion-android-star"></i></a></li>
                                        <li><a href="#"><i class="ion-android-star"></i></a></li>
                                        <li><span>(2)</span></li>
                                    </ul>
                                </div>
                                <h4 class="product_name"><a href="product-details.html">Basic White Simple Sneaker</a></h4>
                                <div class="price_box">
                                    <span class="current_price">$43.00</span>
                                    <span class="old_price">$46.00</span>
                                </div>
                                <div class="add_to_cart">
                                    <a class="btn btn-primary" href="#" data-tippy="Add To Cart" data-tippy-inertia="true" data-tippy-delay="50" data-tippy-arrow="true" data-tippy-placement="top">Add To Cart</a>
                                </div>
                            </div>
                            <div class="product_list_content">
                                <h4 class="product_name"><a href="product-details.html">Basic White Simple Sneaker</a></h4>
                                <p><a href="#">shows</a></p>
                                <div class="price_box">
                                    <span class="current_price">$43.00</span>
                                    <span class="old_price">$46.00</span>
                                </div>
                                <div class="product_desc">
                                    <p>Nunc facilisis sagittis ullamcorper. Proin lectus ipsum, gravida et mattis vulputate, tristique ut lectus. Sed et lorem nunc. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aenean eleifend laoreet congue. Viva..</p>
                                </div>
                                <div class="add_to_cart">
                                    <a class="btn btn-primary" href="#" data-tippy="Add To Cart" data-tippy-inertia="true" data-tippy-delay="50" data-tippy-arrow="true" data-tippy-placement="top">Add To Cart</a>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pagination_style pagination justify-content-center">
                    <ul class="d-flex">
                        <li><a href="#"> &lt;&lt; </a></li>
                        <li><a href="#">1</a></li>
                        <li><a class="current" href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">5</a></li>
                        <li><a href="#">&gt;&gt;</a></li>
                    </ul>
                </div>

                <!--shop toolbar end-->
                <!--shop wrapper end-->
            </div>
        </div>
    </div>
</div>



@* <div class="row justify-content-center mt-3 mb-4">
    <div class="col-sm-6 col-md-8 col-xl-9">
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Buscar producto..." @bind-value="buscar">
            <button class="btn btn-outline-secondary" type="button" @onclick="(async () => await  ObtenerCatalogo())">
                <i class="oi oi-magnifying-glass"></i>
            </button>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-3">
        <div class="card">
            <div class="card-header text-white bg-dark">
                Categorias
            </div>
            <div class="card-body">
                @if (listaCategoria != null)
                {
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="categoria" id="Todos" value="Todos"
                               @onchange="RadioSeleccion"
                               checked=@(categoriaSeleccionada.Equals("Todos"))>
                        <label class="form-check-label" for="Todos">
                            Todos
                        </label>
                    </div>
                    @foreach (var item in listaCategoria)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="categoria" id="@item.IdCategoria" value="@item.Nombre"
                                   @onchange="RadioSeleccion"
                                   checked=@(categoriaSeleccionada.Equals(item.Nombre,StringComparison.OrdinalIgnoreCase))>
                            <label class="form-check-label" for="@item.IdCategoria">
                                @item.Nombre
                            </label>
                        </div>
                    }
                }
                else
                {
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="col-sm-9">
        <div class="row gx-4 row-cols-1 row-cols-md-3 row-cols-xl-4 justify-content-start">
            @if (listaProducto != null)
            {
                foreach (var item in listaProducto)
                {
                    <div class="col mb-5">
                        <div class="card h-100">
                            <!-- Sale badge-->
                            @if (DateTime.Now < item.FechaCreacion.Value.AddDays(30))
                            {
                                <div class="badge bg-primary text-white position-absolute" style="top: 0.5rem; right: 0.5rem">Nuevo</div>
                            }

                            <!-- Product image-->
                            <img class="card-img-top border-dark border-1" src="@item.Imagen" style="width:100%;height:250px">
                            <!-- Product details-->
                            <div class="card-body p-4">
                                <div class="text-center">
                                    <!-- Product name-->
                                    <h5 class="fw-bolder">@item.Nombre</h5>
                                    <!-- Product price-->
                                    @if (item.PrecioOferta != 0 && item.PrecioOferta < item.Precio)
                                    {
                                        <span class="text-danger text-decoration-line-through">$ @item.Precio</span>
                                        <span>$ @item.PrecioOferta</span>
                                    }
                                    else
                                    {
                                        <span>$ @item.Precio</span>
                                    }
                                </div>
                            </div>
                            <div class="card-footer p-3 pt-0 border-top-0 bg-transparent">
                                <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="/detail/@item.IdProducto">Ver producto</a></div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            }
        </div>
    </div>
</div>
 *@
<Footer />

@code {
    private List<CategoriaDTO>? listaCategoria = null;
    private List<ProductoDTO>? listaProducto = null;
    private string buscar = "";
    private string categoriaSeleccionada = "Todos";
    private List<BreadCrumb.BreadcrumbItem> breadcrumbItems;

    private async Task ObtenerCategorias(string Valor = "")
    {
        var response = await categoriaServicio.List(Valor);

        if (response.IsCorrect)
        {
            listaCategoria = (List<CategoriaDTO>)response.Result!;
        }
        else
        {
            listaCategoria = new List<CategoriaDTO>();
        }
    }
    
    private async Task ObtenerCatalogo()
    {
        var response = await productoServicio.Catalogue(categoriaSeleccionada, buscar);

        if (response.IsCorrect)
        {
            listaProducto = (List<ProductoDTO>)response.Result!;
        }
        else
        {
            listaProducto = new List<ProductoDTO>();
        }
    }

    private async Task RadioSeleccion(ChangeEventArgs args)
    {
        categoriaSeleccionada = args.Value.ToString();
        buscar = "";
        await ObtenerCatalogo();
    }

    protected override async Task OnInitializedAsync()
    {
        breadcrumbItems = new List<BreadCrumb.BreadcrumbItem>
        {
            new BreadCrumb.BreadcrumbItem { Text = "Home", Url = "/" },
            new BreadCrumb.BreadcrumbItem { Text = "Catalogue", Url = "/catalogue" }
        };

        await ObtenerCategorias();
        await ObtenerCatalogo();
    }
}
